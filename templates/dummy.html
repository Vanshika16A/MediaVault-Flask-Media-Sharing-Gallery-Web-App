<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dummy page</title>
</head>
<style>

/* CSS */
.button-74 {
  background-color: #65dda7;
  border: 2px solid #422800;
  border-radius: 30px;
  box-shadow: #422800 4px 4px 0 0;
  color: #422800;
  cursor: pointer;
  display: inline-block;
  font-weight: 600;
  font-size: 18px;
  padding: 0 18px;
  line-height: 50px;
  text-align: center;
  text-decoration: none;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
}

.button-74:hover {
  background-color: #fff;
}

.button-74:active {
  box-shadow: #422800 2px 2px 0 0;
  transform: translate(2px, 2px);
}

@media (min-width: 768px) {
  .button-74 {
    min-width: 120px;
    padding: 0 25px;
  }
}




    ::-webkit-scrollbar {
        width: 20px;
    }

    ::-webkit-scrollbar-track {
        background-color: transparent;
    }

    ::-webkit-scrollbar-thumb {
        background-color: #d6dee1;
    }

    ::-webkit-scrollbar-thumb {
        background-color: #d6dee1;
        border-radius: 20px;
        border: 6px solid transparent;
        background-clip: content-box;
    }

    ::-webkit-scrollbar-thumb:hover {
        background-color: #a8bbbf;
    }

    #box3 {

        padding: 0.5vw;
        flex-grow: 1;
        height: 60vh;
        width: 96vw;
        display: flex;
        flex-direction: row;
        border: 4px solid #4b4949;
        gap: 15px;
        background-color: orange;
    }

    #box5 {
        margin: 0.1vw;
        padding: 1.5%;
        border: 3px solid #4b4949;

        background-color: black;
        display: flex;
        flex-wrap: wrap;
        height: 58vh;
        overflow-y: auto;
        width: 35vw;
        gap: 1%;
    }

    #box7 {
        margin: 0.1vw;
        padding: 1.5%;
        display: flex;
        place-items: center;
        align-content: center;
        flex-direction: column;
        height: 54vh;
        overflow-y: auto;
        width: 15vw;
        gap: 1%;
    }

    #box1 {
        display: flex;
        flex-direction: column;
    }

    #box6 {
        margin: 0.1vw;
        padding: 2.5%;
        flex-grow: 0.4;
        /* border: solid 0.16vw #0de1ef; */
        background-color: black;
        display: flex;
        height: 20vh;
        overflow-x: auto;
        width: 94vw;
        gap: 12px;
    }

    #audio-video {
        place-items: center;
        align-content: center;
        margin: 0.1vw;
        font-size: 2.5rem;
        /* background: #0de1ef; */
        height: 50%;
        gap: 1%;
        width: 20vw;
    }


    #grid-container {
        margin: 0.1vw;
        padding: 1%;
        flex-grow: 0.8;
        /* background-color: #fff; */
        border: 3px solid #fff  ;
        display: flex;
        flex-wrap: wrap;
        overflow-y: auto;
        width: 35vw;
        gap: 12px;
    }

    .grid-item {
        position: relative;
        height: 18vh;
        width: 48%;
        border: 1px solid #fff  ;
        box-sizing: border-box;
    }

    .fr {
        min-width: 8vw;
    }

    .grid-item:hover {
        /* background-color: black; */
        color: #0de1ef;
        opacity: 95%;
        transform: scale(1.1);

    }

    #quality {
            /* background: red; */
        align-items: center;    
        place-items: center;
        align-content: center;
        width: 20vw;
        height: 20vh;
    }

    .grid-item img {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 1;
    }

#controls{
    place-items: center;
    align-content: center;
}

    .check-box input[type="checkbox"]:checked+img {
        background: white;
        opacity: 1;
        /* Set the opacity when checkbox is checked */
    }

    .check-box input[type="checkbox"]:not(:checked)+img {
        opacity: 1;
    }

    .check-box {
        position: relative;
    }

    .check-box input[type="checkbox"] {
        position: absolute;
        top: 0;
        left: 0;
        opacity: 1;
    }


    .range-input {
        -webkit-appearance: none;
        appearance: none;
        width: 30%;
        cursor: pointer;
        outline: none;
        border-radius: 15px;
        height: 6px;
        background: #ccc;
    }

    .range-input::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        height: 15px;
        width: 15px;
        background-color: #6bf0d3;
        border-radius: 50%;
        border: none;
        transition: .2s ease-in-out;
    }

    .range-input::-moz-range-thumb {
        height: 15px;
        width: 15px;
        background-color: #6bf0d3;
        border-radius: 50%;
        border: none;
        transition: .2s ease-in-out;
    }

    .range-input::-webkit-slider-thumb:hover {
        box-shadow: 0 0 0 10px rgba(255, 85, 0, .1)
    }

    .range-input:active::-webkit-slider-thumb {
        box-shadow: 0 0 0 13px rgba(255, 85, 0, .2)
    }

    .range-input:focus::-webkit-slider-thumb {
        box-shadow: 0 0 0 13px rgba(255, 85, 0, .2)
    }

    .range-input::-moz-range-thumb:hover {
        box-shadow: 0 0 0 10px rgba(255, 85, 0, .1)
    }

    .range-input:active::-moz-range-thumb {
        box-shadow: 0 0 0 13px rgba(255, 85, 0, .2)
    }

    .range-input:focus::-moz-range-thumb {
        box-shadow: 0 0 0 13px rgba(255, 85, 0, .2)
    }

    .value2 {
        font-size: 26px;
        width: 50px;
        text-align: center;
    }

    .range-slider {
        flex: 1;
    }

    .sliderticks {
        display: flex;
        justify-content: space-between;
        padding: 0 10px;
    }

    .sliderticks span {
        display: flex;
        justify-content: center;
        width: 1px;
        height: 10px;
        background: #d3d3d3;
        line-height: 40px;
    }


    body {
        font-family: system-ui;
        
        /* background-image: url('https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=750&q=80'); */

    }

    /* .wrapper {
        color: #4b4949;
        background: #6bf0d3;
        max-width: 600px;
        width: 100%;
        height: 300px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: 0 auto;
    } */

    .content {
        width: 100%;
        max-width: 500px;
        height: 80%;
        background: #fff;
        padding: 0px 10px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .range {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }
</style>

<body>
    
    <div id="box3">
        <form action="/process_selection" method="post" id="selectedImages">
            <div id="box5" class="grid-container">
                {% for image in images %}
                <div class="grid-item">

                    <label for="cbtest-{{ loop.index }}" class="check-box">
                        <input type="checkbox" id="cbtest-{{ loop.index }}" ; name="selectedImages" {% if
                            image.image_selected==1 %} checked {% endif %} data-image-id="{{ image.id }}">
                        <img src="{{ image.src }}" alt="{{ image.alt }}" image_selected="{{image.image_selected}}"
                            image_id="{{image.id}}">
                    </label>


                    <div class="form-container">
                        <form id="form1"  onsubmit="updateParameters(this); return false;">
                            
                            <input type="hidden" name="image_id" value="{{ image.id }}">
                            <div>
                            <label for="image_duration">Image Duration:</label>
                            <input class="range-input" type="range" min="1" max="10" name="image_duration"
                                value="{{ image.image_duration }}" >
                            </div><div><label for="image_transition">Image Transition:</label>
                            <input class="range-input" type="range" min="1" max="4" name="image_transition"
                                value="{{ image.image_transition }}">
                            <a href="/edit"><button type="submit">Update</button></div>
                        </form>
                    </div>

                </div>
                {% endfor %}
            </div>
        </form>
        <div id="box7" >
            <a href="/edit">
                <button  class="button-74" role="button">DONE</button>
            </a>
            <button id="selected" class="button-74"">HIDE TIMELINE</button>
            
                <a href="/search"><button style="margin-top: 4vh;" class="button-74" role="button">Images </button>
                </a>
                <a href="/loading"><button style="margin-top: 4vh;" class="button-74" role="button">GENERATE VIDEO</a>

            
        </div>

        <div id="audio-video">
            <div class="form-container2">
                <form id="form2" onsubmit="updateParameters2(this); return false;">
                    <label for="audio_id">Choose an Audio</label>
                    <select id="color" name="audio_id">
                        <option value="0">Audio 1</audio></option>
                        <option value="-1">Audio 2</audio></option>
                        <option value="-2">Audio 3</audio></option>
                        <option value="-3">Audio 4</audio></option>
                        <option value="-4">Audio 5</audio></option>
                    </select>
                    <div>
                    <label for="frames">Set Duration</label></div>  

                    <div class="range">
                        <input type="range" min="1" max="4" value="0" id="frames" name="frames" class="range-input">
                        <div class="value2">0</div>
                    </div>
                    <a href="/edit"><button type="submit"  class="button-74">Update</button>
                </form>
            </div>
            <div id="quality">
                <div class="form-container2">
                    <form id="form3" onsubmit="updateParameters3(this); return false;">
                        <label for="video_quality">Choose Video Quality</label>
                        <select id="color" name="video_quality_id">
                            <option value="1">480p</audio></option>
                            <option value="2">720p</audio></option>
                            <option value="3">1080p</audio></option>
                        </select>
                        <a href="/edit"><button type="submit" class="button-74">Update</button>
                    </form>
                </div>
            </div>
        </div>
        <div id="controls">

        </div>


    </div>



    <div id="box6" class="grid-container">
        {% for image in images %}
        {% if image.image_selected == 1 %}
        <div class="grid-item fr">
            <img src="{{ image.src }}" alt="{{ image.alt }}">
        </div>
        {% endif %}
        {% endfor %}
    </div>


  
</body>
<script>


    document.addEventListener('DOMContentLoaded', function () {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(function (checkbox) {
            checkbox.addEventListener('change', function () {
                const imageId = this.getAttribute('data-image-id');
                const isChecked = this.checked;
                updateImageSelected(imageId, isChecked);
            });
        });
    });

    function updateImageSelected(imageId, isChecked) {
        fetch('/update_image_selected', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                image_id: imageId,
                image_selected: isChecked ? 1 : 0
            })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to update image selection');
                }
            })
            .catch(error => console.error('Error:', error));
    }





    document.addEventListener('DOMContentLoaded', function () {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(function (checkbox) {
            checkbox.addEventListener('change', function () {
                const formContainers = document.querySelectorAll('.form-container');
                formContainers.forEach(function (formContainer) {
                    formContainer.style.display = 'none'; 
                });

                if (this.checked) {
                    const formContainer = this.closest('.grid-item').querySelector('.form-container');
                    formContainer.style.display = 'block';
                    const controlDiv = document.getElementById('controls');
                    // controlDiv.style.backgroundImage = formContainer.image_id
                    controlDiv.innerHTML = '';

// Append formContainer to controlDiv
// controlDiv.appendChild(formContainer);
                    controlDiv.appendChild(formContainer.cloneNode(true));
                    // console.log(formContainer);
                }
            });
        });
    });


    function updateParameters(form1) {
        const formData = new FormData(form1);
        const imageId = formData.get('image_id');
        const imageDuration = formData.get('image_duration');
        const imageTransition = formData.get('image_transition');
        fetch('/update_image', {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (response.ok) {
                    // Handle success
                    console.log('Image details updated successfully');
                } else {
                    // Handle error
                    console.error('Failed to update image details');
                }
            })
            .catch(error => console.error('Error:', error));
    }


    function updateParameters2(form2) {
        const formData = new FormData(form2);
        const audioId = formData.get('audio_id');
        const Frames = formData.get('frames');
        fetch('/add_audio', {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (response.ok) {
                    console.log('Audio details updated successfully');
                } else {
                    // Handle error
                    console.error('Failed to update audio details');
                }
            })
            .catch(error => console.error('Error:', error));
    }



    const sliderEl = document.querySelector("#frames")
    const sliderValue = document.querySelector(".value2")

    sliderEl.addEventListener("input", (event) => {
        const tempSliderValue = event.target.value;
        sliderValue.textContent = tempSliderValue;

        const progress = (tempSliderValue / sliderEl.max) * 100;

        sliderEl.style.background = `linear-gradient(to right, #6bf0d3 ${progress}%, #ccc ${progress}%)`;
    })

    document.getElementById('selected').addEventListener('click', function () {
        const selectedImagesContainer = document.getElementById('box6');
        const isVisible = selectedImagesContainer.style.opacity !== '0';
        var timelineText = document.getElementById('timelineText');
        if (isVisible == 0) {
            this.textContent = 'HIDE TIMELINE';
        } else {
            this.textContent = 'SHOW TIMELINE';
        }
        if (isVisible) {
            selectedImagesContainer.style.opacity = '0';
            hideGridItems();
        } else {
            selectedImagesContainer.style.opacity = '1';
            showGridItems();
        }
    });

    function hideGridItems() {
        const gridContainer = document.getElementById('box6');
        const gridItems = document.querySelectorAll('box6 .grid-item img');
        gridItems.forEach(item => {
            item.style.opacity = '0';
        });
    }

    function showGridItems() {
        const gridContainer = document.getElementById('box6');
        const gridItems = document.querySelectorAll('box6 .grid-item img');
        gridItems.forEach(item => {
            item.style.opacity = '1';
        });
    }



</script>

</html>